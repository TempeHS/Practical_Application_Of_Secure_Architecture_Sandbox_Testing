# Manual Code Review Exercise

## ðŸŽ¯ Overview

Manual code review is the systematic examination of source code by human reviewers to identify security vulnerabilities that automated tools often miss. This exercise teaches you to **apply fundamental software development steps to develop secure code** by analysing authentication, input validation, and business logic implementations.

**Syllabus Alignment:**
- **Code review**: Manual security code inspection
- **Input validation**: Data format and range verification  
- **Authentication**: Identity verification and validation
- **Authorization**: Access control and privilege management
- **Security by design**: Identifying vulnerabilities through systematic analysis

## ï¿½ Prerequisites

**Required Knowledge:**
- Basic Python syntax and functions
- Understanding of web applications and forms
- Familiarity with HTML templates
- Basic database concepts (tables, queries)

**Technical Setup:**
```bash
# Navigate to main project folder
cd /workspaces/Secure_Architecture_Sandbox_Testing_Environment

# Verify you can access the vulnerable application
ls samples/unsecure-pwa/
```

**Expected Output:** You should see files like `main.py`, `user_management.py`, and `templates/` directory.

## ðŸ”§ Step-by-Step Activities

### Activity 1: Application Discovery and Understanding

**What is Manual Code Review?**
Manual code review examines source code line-by-line to find security problems that automated scanners miss. Think of it like proofreading an essay - computers can check spelling, but humans understand context and meaning.

**Key Differences from Automated Testing:**
- **Manual**: Understands business logic and context
- **Automated**: Finds known patterns quickly but misses complex issues

**Step 1.1: Explore the Application Structure**
```bash
# Navigate to the vulnerable application
cd /workspaces/Secure_Architecture_Sandbox_Testing_Environment/samples/unsecure-pwa

# Examine the file structure
ls -la
```

**What you'll see:**
- `main.py` - The main web application (like the front desk)
- `user_management.py` - Handles users and database (like the security office)  
- `templates/` - Web pages users see (like the displays)

**Step 1.2: Read the Main Application**
```bash
# View the main Flask application
cat main.py
```

**Look for:** Routes (web pages), form handling, user authentication flows

### Activity 2: Authentication Security Analysis

**Syllabus Focus:** **Authentication** and **authorization** implementation review

**Step 2.1: Examine User Login Process**
```bash
# Look at the user management functions
cat user_management.py
```

**Find the `retrieveUsers` function and identify:**
1. How usernames are checked against the database
2. How passwords are validated
3. Whether username and password are verified together

**Critical Security Question:** 
Does this code check that the username AND password belong to the same user account?

**Step 2.2: Identify Authentication Vulnerabilities**
Look for these dangerous patterns:
```python
# DANGEROUS: String formatting in SQL queries
cur.execute(f"SELECT * FROM users WHERE username = '{username}'")

# SAFE: Parameterized queries
cur.execute("SELECT * FROM users WHERE username = ?", (username,))
```

### Activity 3: Input Validation and SQL Injection Analysis

**Syllabus Focus:** **Input validation**, **sanitization**, and **SQL injection prevention**

**Step 3.1: Database Query Security Review**
Examine every database query in `user_management.py`:

1. **Find all SQL queries** - Look for `cur.execute()` calls
2. **Check query construction** - Is user input directly inserted into SQL strings?
3. **Identify vulnerable patterns** - Any use of f-strings or + operator with user input

**Common SQL Injection Pattern:**
```python
# This allows attackers to modify the SQL query
query = f"SELECT * FROM users WHERE username = '{user_input}'"
```

**Step 3.2: Trace User Input Flow**
Follow user input from web forms to database:
1. Form data extraction: `request.form["username"]`
2. Data processing: Any validation or sanitization?
3. Database query: How is the data used in SQL?

### Activity 4: Cross-Site Scripting (XSS) Prevention

**Syllabus Focus:** **Cross-site scripting (XSS)** prevention and output encoding

**Step 4.1: Template Security Analysis**
```bash
# Examine HTML templates for XSS vulnerabilities
cat templates/index.html
cat templates/signup.html
```

**Look for dangerous patterns:**
```html
<!-- DANGEROUS: Disables XSS protection -->
{{ user_input|safe }}

<!-- SAFE: Automatic HTML escaping -->
{{ user_input }}
```

**Step 4.2: User-Generated Content Display**
In `user_management.py`, find the `listFeedback` function:
- How is user feedback displayed?
- Is HTML escaping applied to user input?
- Could malicious JavaScript be injected?

### Activity 5: Business Logic Security Review

**Syllabus Focus:** **Authorization** and **access control** implementation

**Step 5.1: Authentication Logic Analysis**
Review the complete authentication process:
1. Does the system verify both username AND password in a single check?
2. Could an attacker use one person's username with another person's password?
3. Are there timing differences that could reveal valid usernames?

**Step 5.2: Access Control Review**
Examine `main.py` routes:
- Are sensitive functions protected?
- Can users access pages they shouldn't?
- Is session validation consistent?

### Activity 6: Error Handling and Information Disclosure

**Syllabus Focus:** **Error handling** and preventing information disclosure

**Step 6.1: Error Message Analysis**
Look for:
- Detailed database error messages shown to users
- Debug information that could help attackers
- File paths or system information in error responses

**Step 6.2: Configuration Security**
Check application settings:
- Is debug mode enabled? (Look for `debug=True`)
- Are security headers implemented?
- How are secrets and keys managed?

## ðŸ“Š Summary

### Key Vulnerabilities to Identify

Through this manual code review, you should discover these critical security issues:

**1. SQL Injection (Critical)**
- **Location**: `user_management.py` - String formatting in SQL queries
- **Impact**: Complete database compromise
- **Syllabus Connection**: Input validation and sanitization failures

**2. Cross-Site Scripting (High)** 
- **Location**: Templates with `|safe` filter usage
- **Impact**: JavaScript injection and session theft
- **Syllabus Connection**: Cross-site scripting (XSS) prevention

**3. Authentication Logic Flaw (High)**
- **Location**: `retrieveUsers` function logic
- **Impact**: Authentication bypass with mixed credentials  
- **Syllabus Connection**: Broken authentication and session management

**4. Information Disclosure (Medium)**
- **Location**: Debug mode and error handling
- **Impact**: Information leakage to attackers
- **Syllabus Connection**: Error handling and security configuration

### Skills Developed

By completing this exercise, you have practiced:
- **Code review**: Systematic manual security analysis
- **Vulnerability identification**: Recognising common security anti-patterns
- **Risk assessment**: Prioritising security issues by impact
- **Security documentation**: Professional vulnerability reporting

### Real-World Application

Manual code review is essential in professional software development because:
- Automated tools miss complex business logic flaws
- Human judgement reduces false positives  
- Context understanding identifies architectural issues
- Required for many security compliance standards

Manual code review complements automated **Static Application Security Testing (SAST)** and **Dynamic Application Security Testing (DAST)** tools to provide comprehensive security coverage.

---

**Next Steps:** Apply these manual review skills alongside automated SAST and DAST tools in upcoming exercises to build a complete security testing methodology.
